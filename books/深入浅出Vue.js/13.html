<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>实例方法和全局API的实现 | 房飞跃的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="房飞跃的博客">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.5df48ca7.css" as="style"><link rel="preload" href="/assets/js/app.590f3e5d.js" as="script"><link rel="preload" href="/assets/js/2.f73decc9.js" as="script"><link rel="preload" href="/assets/js/160.8cdb57f8.js" as="script"><link rel="preload" href="/assets/js/63.b9a657c2.js" as="script"><link rel="prefetch" href="/assets/js/10.36b3eded.js"><link rel="prefetch" href="/assets/js/100.fdda705a.js"><link rel="prefetch" href="/assets/js/101.1c5bcc65.js"><link rel="prefetch" href="/assets/js/102.cbf2e24c.js"><link rel="prefetch" href="/assets/js/103.fbcc2768.js"><link rel="prefetch" href="/assets/js/104.dd789823.js"><link rel="prefetch" href="/assets/js/105.70f42acb.js"><link rel="prefetch" href="/assets/js/106.d2e7b246.js"><link rel="prefetch" href="/assets/js/107.f94a9fac.js"><link rel="prefetch" href="/assets/js/108.0cef0068.js"><link rel="prefetch" href="/assets/js/109.4ce3cdbd.js"><link rel="prefetch" href="/assets/js/11.b581d225.js"><link rel="prefetch" href="/assets/js/110.ea6d13b1.js"><link rel="prefetch" href="/assets/js/111.0a815db3.js"><link rel="prefetch" href="/assets/js/112.231e2995.js"><link rel="prefetch" href="/assets/js/113.a47d5167.js"><link rel="prefetch" href="/assets/js/114.527b5e8c.js"><link rel="prefetch" href="/assets/js/115.4df6874a.js"><link rel="prefetch" href="/assets/js/116.2606e7be.js"><link rel="prefetch" href="/assets/js/117.d54bfc25.js"><link rel="prefetch" href="/assets/js/118.9862082e.js"><link rel="prefetch" href="/assets/js/119.a75e8894.js"><link rel="prefetch" href="/assets/js/12.41a5ab33.js"><link rel="prefetch" href="/assets/js/120.6e13557a.js"><link rel="prefetch" href="/assets/js/121.eafa87fa.js"><link rel="prefetch" href="/assets/js/122.e4c849dc.js"><link rel="prefetch" href="/assets/js/123.dedb825a.js"><link rel="prefetch" href="/assets/js/124.afeaa1c4.js"><link rel="prefetch" href="/assets/js/125.b25549b3.js"><link rel="prefetch" href="/assets/js/126.4c3d3fcb.js"><link rel="prefetch" href="/assets/js/127.4c98858a.js"><link rel="prefetch" href="/assets/js/128.854b8cc1.js"><link rel="prefetch" href="/assets/js/129.112e862a.js"><link rel="prefetch" href="/assets/js/13.ee1d9787.js"><link rel="prefetch" href="/assets/js/130.b88070a9.js"><link rel="prefetch" href="/assets/js/131.29e91054.js"><link rel="prefetch" href="/assets/js/132.248e712b.js"><link rel="prefetch" href="/assets/js/133.0b7be740.js"><link rel="prefetch" href="/assets/js/134.ceb9c04b.js"><link rel="prefetch" href="/assets/js/135.599ee1d5.js"><link rel="prefetch" href="/assets/js/136.ce5bcf19.js"><link rel="prefetch" href="/assets/js/137.51f0a6b4.js"><link rel="prefetch" href="/assets/js/138.91bc64aa.js"><link rel="prefetch" href="/assets/js/139.300c0ef9.js"><link rel="prefetch" href="/assets/js/14.39a205f1.js"><link rel="prefetch" href="/assets/js/140.7044d372.js"><link rel="prefetch" href="/assets/js/141.9a9d663a.js"><link rel="prefetch" href="/assets/js/142.814b7237.js"><link rel="prefetch" href="/assets/js/143.1ce72115.js"><link rel="prefetch" href="/assets/js/144.f82c0950.js"><link rel="prefetch" href="/assets/js/145.2b4ef4fc.js"><link rel="prefetch" href="/assets/js/146.8b80954b.js"><link rel="prefetch" href="/assets/js/147.fe15e14a.js"><link rel="prefetch" href="/assets/js/148.29803b80.js"><link rel="prefetch" href="/assets/js/149.a3995f20.js"><link rel="prefetch" href="/assets/js/15.db4b1d97.js"><link rel="prefetch" href="/assets/js/150.02476224.js"><link rel="prefetch" href="/assets/js/151.34d53d30.js"><link rel="prefetch" href="/assets/js/152.f4382542.js"><link rel="prefetch" href="/assets/js/153.7986e095.js"><link rel="prefetch" href="/assets/js/154.cb74fee8.js"><link rel="prefetch" href="/assets/js/155.f933c4d1.js"><link rel="prefetch" href="/assets/js/156.9e450f38.js"><link rel="prefetch" href="/assets/js/157.4374f6c6.js"><link rel="prefetch" href="/assets/js/158.e31f0038.js"><link rel="prefetch" href="/assets/js/159.acbfc21e.js"><link rel="prefetch" href="/assets/js/16.9deed75c.js"><link rel="prefetch" href="/assets/js/161.3eca6d69.js"><link rel="prefetch" href="/assets/js/162.d67e29cf.js"><link rel="prefetch" href="/assets/js/163.d7d8a363.js"><link rel="prefetch" href="/assets/js/164.153713be.js"><link rel="prefetch" href="/assets/js/165.4ec834cb.js"><link rel="prefetch" href="/assets/js/166.6584eb16.js"><link rel="prefetch" href="/assets/js/167.c3edfee1.js"><link rel="prefetch" href="/assets/js/168.1605a092.js"><link rel="prefetch" href="/assets/js/169.c7aebeb4.js"><link rel="prefetch" href="/assets/js/17.d7e980f9.js"><link rel="prefetch" href="/assets/js/170.a38f18fe.js"><link rel="prefetch" href="/assets/js/171.761cf543.js"><link rel="prefetch" href="/assets/js/172.1f4b197e.js"><link rel="prefetch" href="/assets/js/173.34ebda5b.js"><link rel="prefetch" href="/assets/js/174.8c76d6e4.js"><link rel="prefetch" href="/assets/js/175.ad549e70.js"><link rel="prefetch" href="/assets/js/176.9866d668.js"><link rel="prefetch" href="/assets/js/177.1376a82c.js"><link rel="prefetch" href="/assets/js/178.2f222d8d.js"><link rel="prefetch" href="/assets/js/179.516a4e47.js"><link rel="prefetch" href="/assets/js/18.55ece6ed.js"><link rel="prefetch" href="/assets/js/180.1c448ad8.js"><link rel="prefetch" href="/assets/js/181.a4745dce.js"><link rel="prefetch" href="/assets/js/182.060ce287.js"><link rel="prefetch" href="/assets/js/183.aa397cf5.js"><link rel="prefetch" href="/assets/js/184.eedb5e7b.js"><link rel="prefetch" href="/assets/js/185.e13c55ec.js"><link rel="prefetch" href="/assets/js/186.e7d5c72b.js"><link rel="prefetch" href="/assets/js/187.6cc11c55.js"><link rel="prefetch" href="/assets/js/188.bff141ef.js"><link rel="prefetch" href="/assets/js/189.54cda1bb.js"><link rel="prefetch" href="/assets/js/19.6969d652.js"><link rel="prefetch" href="/assets/js/190.df4b36f2.js"><link rel="prefetch" href="/assets/js/191.b1602a58.js"><link rel="prefetch" href="/assets/js/192.8a143411.js"><link rel="prefetch" href="/assets/js/193.e31348b9.js"><link rel="prefetch" href="/assets/js/194.ef1f0a74.js"><link rel="prefetch" href="/assets/js/195.77ef93ce.js"><link rel="prefetch" href="/assets/js/196.fda6b3dd.js"><link rel="prefetch" href="/assets/js/197.51f02977.js"><link rel="prefetch" href="/assets/js/198.bf7775ee.js"><link rel="prefetch" href="/assets/js/199.dfa0fce8.js"><link rel="prefetch" href="/assets/js/20.0a0371f1.js"><link rel="prefetch" href="/assets/js/200.633b314b.js"><link rel="prefetch" href="/assets/js/201.abcba495.js"><link rel="prefetch" href="/assets/js/202.e05a3558.js"><link rel="prefetch" href="/assets/js/203.55a478a3.js"><link rel="prefetch" href="/assets/js/204.45db1987.js"><link rel="prefetch" href="/assets/js/205.e7610693.js"><link rel="prefetch" href="/assets/js/206.a31bc767.js"><link rel="prefetch" href="/assets/js/207.1aad1d13.js"><link rel="prefetch" href="/assets/js/208.6b93971f.js"><link rel="prefetch" href="/assets/js/209.2c1396dc.js"><link rel="prefetch" href="/assets/js/21.5f3d0414.js"><link rel="prefetch" href="/assets/js/210.bb90faf0.js"><link rel="prefetch" href="/assets/js/211.6aacd030.js"><link rel="prefetch" href="/assets/js/212.a341bb68.js"><link rel="prefetch" href="/assets/js/213.3e163adf.js"><link rel="prefetch" href="/assets/js/214.2519eb04.js"><link rel="prefetch" href="/assets/js/215.31a56efc.js"><link rel="prefetch" href="/assets/js/216.5f6e4518.js"><link rel="prefetch" href="/assets/js/217.d9618812.js"><link rel="prefetch" href="/assets/js/218.d386c011.js"><link rel="prefetch" href="/assets/js/219.395af281.js"><link rel="prefetch" href="/assets/js/22.1a5b1251.js"><link rel="prefetch" href="/assets/js/220.615b3dac.js"><link rel="prefetch" href="/assets/js/221.33401568.js"><link rel="prefetch" href="/assets/js/222.a080e6cc.js"><link rel="prefetch" href="/assets/js/223.ae2084fb.js"><link rel="prefetch" href="/assets/js/224.6bc203fe.js"><link rel="prefetch" href="/assets/js/225.7e4737a3.js"><link rel="prefetch" href="/assets/js/226.ec6a690d.js"><link rel="prefetch" href="/assets/js/227.967f1c41.js"><link rel="prefetch" href="/assets/js/228.c72d8b21.js"><link rel="prefetch" href="/assets/js/229.48dd2f01.js"><link rel="prefetch" href="/assets/js/23.76e30a13.js"><link rel="prefetch" href="/assets/js/230.1c02b6ab.js"><link rel="prefetch" href="/assets/js/231.8cf14ae6.js"><link rel="prefetch" href="/assets/js/232.4e00abc6.js"><link rel="prefetch" href="/assets/js/233.9a6bfb8c.js"><link rel="prefetch" href="/assets/js/234.7b1814f9.js"><link rel="prefetch" href="/assets/js/235.414e1dad.js"><link rel="prefetch" href="/assets/js/236.5926b488.js"><link rel="prefetch" href="/assets/js/237.df3857ea.js"><link rel="prefetch" href="/assets/js/238.c560dcf8.js"><link rel="prefetch" href="/assets/js/239.842efd50.js"><link rel="prefetch" href="/assets/js/24.1febfcd1.js"><link rel="prefetch" href="/assets/js/240.d47f24ed.js"><link rel="prefetch" href="/assets/js/241.ab01ea87.js"><link rel="prefetch" href="/assets/js/242.a5f6d83f.js"><link rel="prefetch" href="/assets/js/243.cac5f5c3.js"><link rel="prefetch" href="/assets/js/244.90105026.js"><link rel="prefetch" href="/assets/js/245.b18fffa1.js"><link rel="prefetch" href="/assets/js/246.941bcf8d.js"><link rel="prefetch" href="/assets/js/247.8b295baa.js"><link rel="prefetch" href="/assets/js/248.c6a61d12.js"><link rel="prefetch" href="/assets/js/249.22ff657f.js"><link rel="prefetch" href="/assets/js/25.6fbbd83f.js"><link rel="prefetch" href="/assets/js/250.8a2def71.js"><link rel="prefetch" href="/assets/js/251.aa4f0601.js"><link rel="prefetch" href="/assets/js/252.3f58bfa4.js"><link rel="prefetch" href="/assets/js/253.5623e75b.js"><link rel="prefetch" href="/assets/js/254.2f1a1bc8.js"><link rel="prefetch" href="/assets/js/255.fea91b4d.js"><link rel="prefetch" href="/assets/js/256.c4c8e156.js"><link rel="prefetch" href="/assets/js/257.31d016a7.js"><link rel="prefetch" href="/assets/js/258.cec0b239.js"><link rel="prefetch" href="/assets/js/259.61328dd2.js"><link rel="prefetch" href="/assets/js/26.823de7af.js"><link rel="prefetch" href="/assets/js/260.acb4619a.js"><link rel="prefetch" href="/assets/js/261.4eeae626.js"><link rel="prefetch" href="/assets/js/262.f7dbbd08.js"><link rel="prefetch" href="/assets/js/263.5c54eb81.js"><link rel="prefetch" href="/assets/js/264.751669e3.js"><link rel="prefetch" href="/assets/js/265.545aea2a.js"><link rel="prefetch" href="/assets/js/266.e588f376.js"><link rel="prefetch" href="/assets/js/267.65d67eff.js"><link rel="prefetch" href="/assets/js/268.9d7592ba.js"><link rel="prefetch" href="/assets/js/269.c44c063e.js"><link rel="prefetch" href="/assets/js/27.988d824e.js"><link rel="prefetch" href="/assets/js/270.1addc830.js"><link rel="prefetch" href="/assets/js/271.0d4b2272.js"><link rel="prefetch" href="/assets/js/272.8d3e01fc.js"><link rel="prefetch" href="/assets/js/273.fe83a7a4.js"><link rel="prefetch" href="/assets/js/274.c3f8880a.js"><link rel="prefetch" href="/assets/js/275.01d7762a.js"><link rel="prefetch" href="/assets/js/276.58095ef7.js"><link rel="prefetch" href="/assets/js/277.44657e6b.js"><link rel="prefetch" href="/assets/js/278.2331d394.js"><link rel="prefetch" href="/assets/js/279.81ad3829.js"><link rel="prefetch" href="/assets/js/28.95c94d01.js"><link rel="prefetch" href="/assets/js/280.a284b116.js"><link rel="prefetch" href="/assets/js/281.e1050af8.js"><link rel="prefetch" href="/assets/js/282.b486d445.js"><link rel="prefetch" href="/assets/js/283.e22170bd.js"><link rel="prefetch" href="/assets/js/284.3c8def33.js"><link rel="prefetch" href="/assets/js/285.1bc70cce.js"><link rel="prefetch" href="/assets/js/286.a31fe5c5.js"><link rel="prefetch" href="/assets/js/287.90b937ac.js"><link rel="prefetch" href="/assets/js/288.73647716.js"><link rel="prefetch" href="/assets/js/289.6a231446.js"><link rel="prefetch" href="/assets/js/29.53562974.js"><link rel="prefetch" href="/assets/js/290.3bbc1445.js"><link rel="prefetch" href="/assets/js/291.82092bf1.js"><link rel="prefetch" href="/assets/js/292.da50c68b.js"><link rel="prefetch" href="/assets/js/293.3bb527ee.js"><link rel="prefetch" href="/assets/js/294.ba612d56.js"><link rel="prefetch" href="/assets/js/295.18639d50.js"><link rel="prefetch" href="/assets/js/296.1d39ebf1.js"><link rel="prefetch" href="/assets/js/297.d327b395.js"><link rel="prefetch" href="/assets/js/298.2cd88ff7.js"><link rel="prefetch" href="/assets/js/299.9a585823.js"><link rel="prefetch" href="/assets/js/3.434820ad.js"><link rel="prefetch" href="/assets/js/30.65faad2e.js"><link rel="prefetch" href="/assets/js/300.9408a130.js"><link rel="prefetch" href="/assets/js/301.61243e7d.js"><link rel="prefetch" href="/assets/js/302.626e76e0.js"><link rel="prefetch" href="/assets/js/303.2ffb53aa.js"><link rel="prefetch" href="/assets/js/304.47a7cbc4.js"><link rel="prefetch" href="/assets/js/305.87d2dbcd.js"><link rel="prefetch" href="/assets/js/306.d010dd8a.js"><link rel="prefetch" href="/assets/js/307.52aa5991.js"><link rel="prefetch" href="/assets/js/308.c31fe4d2.js"><link rel="prefetch" href="/assets/js/309.30705de0.js"><link rel="prefetch" href="/assets/js/31.55e60aaa.js"><link rel="prefetch" href="/assets/js/310.2ea3101e.js"><link rel="prefetch" href="/assets/js/311.c8367c67.js"><link rel="prefetch" href="/assets/js/312.3437ad0d.js"><link rel="prefetch" href="/assets/js/313.650f3835.js"><link rel="prefetch" href="/assets/js/314.5a9617cf.js"><link rel="prefetch" href="/assets/js/315.6c7dee46.js"><link rel="prefetch" href="/assets/js/316.f4c868c1.js"><link rel="prefetch" href="/assets/js/317.dabc9003.js"><link rel="prefetch" href="/assets/js/318.94a3ede0.js"><link rel="prefetch" href="/assets/js/319.87c920f8.js"><link rel="prefetch" href="/assets/js/32.64ad9712.js"><link rel="prefetch" href="/assets/js/320.8757ca2c.js"><link rel="prefetch" href="/assets/js/321.6e2783d5.js"><link rel="prefetch" href="/assets/js/322.f8996296.js"><link rel="prefetch" href="/assets/js/323.302a6fef.js"><link rel="prefetch" href="/assets/js/324.d6fd3e0b.js"><link rel="prefetch" href="/assets/js/325.e0782dc3.js"><link rel="prefetch" href="/assets/js/326.60d0aab3.js"><link rel="prefetch" href="/assets/js/327.7f840ace.js"><link rel="prefetch" href="/assets/js/328.e2976e72.js"><link rel="prefetch" href="/assets/js/329.d8eacc74.js"><link rel="prefetch" href="/assets/js/33.3e5e84ce.js"><link rel="prefetch" href="/assets/js/330.f12e597e.js"><link rel="prefetch" href="/assets/js/331.bf741811.js"><link rel="prefetch" href="/assets/js/332.2a5e7914.js"><link rel="prefetch" href="/assets/js/333.5ef9eecd.js"><link rel="prefetch" href="/assets/js/334.124452eb.js"><link rel="prefetch" href="/assets/js/335.c80162a9.js"><link rel="prefetch" href="/assets/js/336.286ad2d8.js"><link rel="prefetch" href="/assets/js/337.c27fb6f2.js"><link rel="prefetch" href="/assets/js/338.73fbb9b7.js"><link rel="prefetch" href="/assets/js/339.dcdb4c9d.js"><link rel="prefetch" href="/assets/js/34.3a9de936.js"><link rel="prefetch" href="/assets/js/340.6e61aa11.js"><link rel="prefetch" href="/assets/js/341.2aca9f6f.js"><link rel="prefetch" href="/assets/js/342.1d1f8c28.js"><link rel="prefetch" href="/assets/js/343.f8d954e6.js"><link rel="prefetch" href="/assets/js/344.afcd59c9.js"><link rel="prefetch" href="/assets/js/345.ce25fe01.js"><link rel="prefetch" href="/assets/js/346.80ae36ff.js"><link rel="prefetch" href="/assets/js/347.bb07eed8.js"><link rel="prefetch" href="/assets/js/348.d17a0f1d.js"><link rel="prefetch" href="/assets/js/349.7ebf510a.js"><link rel="prefetch" href="/assets/js/35.06f788fc.js"><link rel="prefetch" href="/assets/js/350.68b134bf.js"><link rel="prefetch" href="/assets/js/351.09592f5d.js"><link rel="prefetch" href="/assets/js/352.1d08e41d.js"><link rel="prefetch" href="/assets/js/353.4cc57dd3.js"><link rel="prefetch" href="/assets/js/354.bf18a8e7.js"><link rel="prefetch" href="/assets/js/355.81b52c01.js"><link rel="prefetch" href="/assets/js/356.9ddd11b7.js"><link rel="prefetch" href="/assets/js/357.5083b1cb.js"><link rel="prefetch" href="/assets/js/358.b574bd41.js"><link rel="prefetch" href="/assets/js/359.aa0f66a0.js"><link rel="prefetch" href="/assets/js/36.619ee85c.js"><link rel="prefetch" href="/assets/js/360.e2f48183.js"><link rel="prefetch" href="/assets/js/361.79b1250b.js"><link rel="prefetch" href="/assets/js/362.238d5116.js"><link rel="prefetch" href="/assets/js/363.f9ed76f9.js"><link rel="prefetch" href="/assets/js/364.29ecc302.js"><link rel="prefetch" href="/assets/js/365.af5dfb84.js"><link rel="prefetch" href="/assets/js/366.803b9b34.js"><link rel="prefetch" href="/assets/js/367.cfb5cda4.js"><link rel="prefetch" href="/assets/js/368.371608df.js"><link rel="prefetch" href="/assets/js/369.236637e4.js"><link rel="prefetch" href="/assets/js/37.993e4753.js"><link rel="prefetch" href="/assets/js/370.a7736151.js"><link rel="prefetch" href="/assets/js/371.cea6669c.js"><link rel="prefetch" href="/assets/js/372.dd7b7cb8.js"><link rel="prefetch" href="/assets/js/373.b35db4ab.js"><link rel="prefetch" href="/assets/js/374.6d1a51a7.js"><link rel="prefetch" href="/assets/js/375.524a59d5.js"><link rel="prefetch" href="/assets/js/376.e61ff9c4.js"><link rel="prefetch" href="/assets/js/377.20f5524b.js"><link rel="prefetch" href="/assets/js/378.27f22518.js"><link rel="prefetch" href="/assets/js/379.2e302826.js"><link rel="prefetch" href="/assets/js/38.eed8aa34.js"><link rel="prefetch" href="/assets/js/380.cdcd87ce.js"><link rel="prefetch" href="/assets/js/381.24fb213f.js"><link rel="prefetch" href="/assets/js/382.101b4319.js"><link rel="prefetch" href="/assets/js/383.2a16e8b6.js"><link rel="prefetch" href="/assets/js/384.a20d693f.js"><link rel="prefetch" href="/assets/js/385.17e97477.js"><link rel="prefetch" href="/assets/js/386.6e239e8e.js"><link rel="prefetch" href="/assets/js/387.beb4354b.js"><link rel="prefetch" href="/assets/js/388.035fc37a.js"><link rel="prefetch" href="/assets/js/389.4017e30f.js"><link rel="prefetch" href="/assets/js/39.aab0b851.js"><link rel="prefetch" href="/assets/js/390.11b2f597.js"><link rel="prefetch" href="/assets/js/391.3b193822.js"><link rel="prefetch" href="/assets/js/392.25c1d9f6.js"><link rel="prefetch" href="/assets/js/393.931523ed.js"><link rel="prefetch" href="/assets/js/394.2ba9d35e.js"><link rel="prefetch" href="/assets/js/395.201269ae.js"><link rel="prefetch" href="/assets/js/396.73113431.js"><link rel="prefetch" href="/assets/js/397.d8059292.js"><link rel="prefetch" href="/assets/js/398.1727254c.js"><link rel="prefetch" href="/assets/js/399.343ad520.js"><link rel="prefetch" href="/assets/js/4.2580f809.js"><link rel="prefetch" href="/assets/js/40.4d7aaeb7.js"><link rel="prefetch" href="/assets/js/400.53388b6b.js"><link rel="prefetch" href="/assets/js/401.961883b0.js"><link rel="prefetch" href="/assets/js/402.d35c2c6f.js"><link rel="prefetch" href="/assets/js/403.b4e7f97b.js"><link rel="prefetch" href="/assets/js/404.e8c3790b.js"><link rel="prefetch" href="/assets/js/405.15e5c920.js"><link rel="prefetch" href="/assets/js/406.9d41b3c8.js"><link rel="prefetch" href="/assets/js/407.09d6db7d.js"><link rel="prefetch" href="/assets/js/408.4fc3ccd6.js"><link rel="prefetch" href="/assets/js/409.0a858daf.js"><link rel="prefetch" href="/assets/js/41.e0a60d57.js"><link rel="prefetch" href="/assets/js/410.0260ca3a.js"><link rel="prefetch" href="/assets/js/411.a15abcd5.js"><link rel="prefetch" href="/assets/js/412.24731dfb.js"><link rel="prefetch" href="/assets/js/413.f55fe0d7.js"><link rel="prefetch" href="/assets/js/414.c54e0627.js"><link rel="prefetch" href="/assets/js/415.cc651a30.js"><link rel="prefetch" href="/assets/js/416.486798f0.js"><link rel="prefetch" href="/assets/js/417.0d5a5b42.js"><link rel="prefetch" href="/assets/js/418.66e4498a.js"><link rel="prefetch" href="/assets/js/419.0b57a78f.js"><link rel="prefetch" href="/assets/js/42.0a7a5e68.js"><link rel="prefetch" href="/assets/js/420.500f2570.js"><link rel="prefetch" href="/assets/js/421.4b0d1a76.js"><link rel="prefetch" href="/assets/js/422.b0fc956e.js"><link rel="prefetch" href="/assets/js/423.14392a44.js"><link rel="prefetch" href="/assets/js/424.c4ba9afa.js"><link rel="prefetch" href="/assets/js/425.057f73ae.js"><link rel="prefetch" href="/assets/js/426.dffd3bb6.js"><link rel="prefetch" href="/assets/js/427.337b47c5.js"><link rel="prefetch" href="/assets/js/428.9f9b5f22.js"><link rel="prefetch" href="/assets/js/429.0ed4b794.js"><link rel="prefetch" href="/assets/js/43.84e3ad33.js"><link rel="prefetch" href="/assets/js/430.398efdef.js"><link rel="prefetch" href="/assets/js/431.9688dbc7.js"><link rel="prefetch" href="/assets/js/432.92bab9f6.js"><link rel="prefetch" href="/assets/js/433.fc4360d3.js"><link rel="prefetch" href="/assets/js/434.1068f226.js"><link rel="prefetch" href="/assets/js/435.64318382.js"><link rel="prefetch" href="/assets/js/436.992a5ea4.js"><link rel="prefetch" href="/assets/js/437.51e1f4e6.js"><link rel="prefetch" href="/assets/js/438.dc345e24.js"><link rel="prefetch" href="/assets/js/439.ca03ba3a.js"><link rel="prefetch" href="/assets/js/44.4c1cfe42.js"><link rel="prefetch" href="/assets/js/440.4c2e1760.js"><link rel="prefetch" href="/assets/js/441.dc889ecf.js"><link rel="prefetch" href="/assets/js/442.b629a091.js"><link rel="prefetch" href="/assets/js/443.93eadd08.js"><link rel="prefetch" href="/assets/js/444.69befc9e.js"><link rel="prefetch" href="/assets/js/445.6b18e387.js"><link rel="prefetch" href="/assets/js/446.dc4ef99c.js"><link rel="prefetch" href="/assets/js/447.349de474.js"><link rel="prefetch" href="/assets/js/448.22e2e6c7.js"><link rel="prefetch" href="/assets/js/449.b78455e5.js"><link rel="prefetch" href="/assets/js/45.03e75bbd.js"><link rel="prefetch" href="/assets/js/450.3e256487.js"><link rel="prefetch" href="/assets/js/451.23525476.js"><link rel="prefetch" href="/assets/js/452.7383b385.js"><link rel="prefetch" href="/assets/js/453.1a7553c1.js"><link rel="prefetch" href="/assets/js/454.9bdee81b.js"><link rel="prefetch" href="/assets/js/455.e0eb6a97.js"><link rel="prefetch" href="/assets/js/456.820ffa9c.js"><link rel="prefetch" href="/assets/js/457.4639b3cd.js"><link rel="prefetch" href="/assets/js/458.7e4d9d2a.js"><link rel="prefetch" href="/assets/js/459.1b4becf2.js"><link rel="prefetch" href="/assets/js/46.5c7d982f.js"><link rel="prefetch" href="/assets/js/460.d6e052a2.js"><link rel="prefetch" href="/assets/js/461.ebb726a4.js"><link rel="prefetch" href="/assets/js/462.3c62f062.js"><link rel="prefetch" href="/assets/js/463.072730fc.js"><link rel="prefetch" href="/assets/js/464.05b6f3e9.js"><link rel="prefetch" href="/assets/js/465.5f1d1530.js"><link rel="prefetch" href="/assets/js/466.8a677003.js"><link rel="prefetch" href="/assets/js/467.2eb0a0ff.js"><link rel="prefetch" href="/assets/js/468.1e3bce7c.js"><link rel="prefetch" href="/assets/js/469.63b4c7dd.js"><link rel="prefetch" href="/assets/js/47.4349c0cc.js"><link rel="prefetch" href="/assets/js/470.aad91611.js"><link rel="prefetch" href="/assets/js/471.00283a40.js"><link rel="prefetch" href="/assets/js/472.8260893c.js"><link rel="prefetch" href="/assets/js/473.cce9db55.js"><link rel="prefetch" href="/assets/js/474.503f3087.js"><link rel="prefetch" href="/assets/js/475.ba2c46da.js"><link rel="prefetch" href="/assets/js/476.d1acddf7.js"><link rel="prefetch" href="/assets/js/477.b05b815e.js"><link rel="prefetch" href="/assets/js/478.f2b25b77.js"><link rel="prefetch" href="/assets/js/479.e0e4d348.js"><link rel="prefetch" href="/assets/js/48.64ebf972.js"><link rel="prefetch" href="/assets/js/480.e7267fa4.js"><link rel="prefetch" href="/assets/js/481.dd4125c5.js"><link rel="prefetch" href="/assets/js/482.ca49dd42.js"><link rel="prefetch" href="/assets/js/483.11b1e5e0.js"><link rel="prefetch" href="/assets/js/484.57f34a7f.js"><link rel="prefetch" href="/assets/js/485.46d9e9c6.js"><link rel="prefetch" href="/assets/js/486.69cee9b4.js"><link rel="prefetch" href="/assets/js/487.1956009f.js"><link rel="prefetch" href="/assets/js/49.8974c4f9.js"><link rel="prefetch" href="/assets/js/5.6a84a49e.js"><link rel="prefetch" href="/assets/js/50.5c084833.js"><link rel="prefetch" href="/assets/js/51.9b99bea9.js"><link rel="prefetch" href="/assets/js/52.3a585fc0.js"><link rel="prefetch" href="/assets/js/53.64b65dcb.js"><link rel="prefetch" href="/assets/js/54.01c85c4a.js"><link rel="prefetch" href="/assets/js/55.6d3cc522.js"><link rel="prefetch" href="/assets/js/56.9cd660c8.js"><link rel="prefetch" href="/assets/js/57.11e1801d.js"><link rel="prefetch" href="/assets/js/58.d9e5f847.js"><link rel="prefetch" href="/assets/js/59.a5e2472c.js"><link rel="prefetch" href="/assets/js/6.d4f8e32a.js"><link rel="prefetch" href="/assets/js/60.77db5315.js"><link rel="prefetch" href="/assets/js/61.da28c70d.js"><link rel="prefetch" href="/assets/js/62.405b03e1.js"><link rel="prefetch" href="/assets/js/64.69c64784.js"><link rel="prefetch" href="/assets/js/65.cee0c834.js"><link rel="prefetch" href="/assets/js/66.9fa85082.js"><link rel="prefetch" href="/assets/js/67.ebc9eb8d.js"><link rel="prefetch" href="/assets/js/68.8d7f5fd5.js"><link rel="prefetch" href="/assets/js/69.9b3498b1.js"><link rel="prefetch" href="/assets/js/7.83f99489.js"><link rel="prefetch" href="/assets/js/70.8c0a3b25.js"><link rel="prefetch" href="/assets/js/71.6d24abff.js"><link rel="prefetch" href="/assets/js/72.17f36f5a.js"><link rel="prefetch" href="/assets/js/73.ade71c5d.js"><link rel="prefetch" href="/assets/js/74.6d9312f1.js"><link rel="prefetch" href="/assets/js/75.f30ed904.js"><link rel="prefetch" href="/assets/js/76.84ef8356.js"><link rel="prefetch" href="/assets/js/77.4c58a88a.js"><link rel="prefetch" href="/assets/js/78.0ace38df.js"><link rel="prefetch" href="/assets/js/79.825c03e7.js"><link rel="prefetch" href="/assets/js/8.60f0b36d.js"><link rel="prefetch" href="/assets/js/80.63f7e2bb.js"><link rel="prefetch" href="/assets/js/81.62e051ed.js"><link rel="prefetch" href="/assets/js/82.26828682.js"><link rel="prefetch" href="/assets/js/83.be70428b.js"><link rel="prefetch" href="/assets/js/84.aa44143b.js"><link rel="prefetch" href="/assets/js/85.cc38e2a9.js"><link rel="prefetch" href="/assets/js/86.9a8beb01.js"><link rel="prefetch" href="/assets/js/87.a051754c.js"><link rel="prefetch" href="/assets/js/88.0fe5a9f8.js"><link rel="prefetch" href="/assets/js/89.c2d41d94.js"><link rel="prefetch" href="/assets/js/9.375ffec2.js"><link rel="prefetch" href="/assets/js/90.3bd7045a.js"><link rel="prefetch" href="/assets/js/91.dbfd3514.js"><link rel="prefetch" href="/assets/js/92.ee0349b9.js"><link rel="prefetch" href="/assets/js/93.3bbfbbd0.js"><link rel="prefetch" href="/assets/js/94.fb94c70b.js"><link rel="prefetch" href="/assets/js/95.59de5eae.js"><link rel="prefetch" href="/assets/js/96.ebb2c66f.js"><link rel="prefetch" href="/assets/js/97.660aef77.js"><link rel="prefetch" href="/assets/js/98.8d7946e1.js"><link rel="prefetch" href="/assets/js/99.f319da86.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5df48ca7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="房飞跃的博客" class="logo"> <span class="site-name can-hide">房飞跃的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Vue
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/深入浅出Vue.js/01.html" class="nav-link">
  深入浅出Vue
</a></li><li class="dropdown-subitem"><a href="/front/vue/vue/01.html" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/front/vue/vue-router/01.html" class="nav-link">
  VueRouter
</a></li><li class="dropdown-subitem"><a href="/front/vue/Vuex/01.html" class="nav-link">
  Vuex
</a></li><li class="dropdown-subitem"><a href="/front/vue/vue3/01.html" class="nav-link">
  Vue3核心剖析
</a></li><li class="dropdown-subitem"><a href="/front/vue/Vue知识点简单梳理/01.html" class="nav-link">
  Vue知识点简单梳理
</a></li></ul></li><li class="dropdown-item"><h4>
          React
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/深入React技术栈/01.html" class="nav-link">
  深入React技术栈
</a></li><li class="dropdown-subitem"><a href="/front/react/React进阶实践指南/01.html" class="nav-link">
  React进阶实践指南
</a></li><li class="dropdown-subitem"><a href="/front/react/React知识点简单梳理/01.html" class="nav-link">
  React知识点简单梳理
</a></li></ul></li><li class="dropdown-item"><h4>
          混合开发
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/混合开发/01.html" class="nav-link">
  混合开发探究
</a></li></ul></li><li class="dropdown-item"><h4>
          TypeScript
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/ts/极简入门Typescript/01.html" class="nav-link">
  极简入门Typescript
</a></li></ul></li><li class="dropdown-item"><h4>
          Webpack
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/webpack/极简入门webpack/01.html" class="nav-link">
  极简入门
</a></li><li class="dropdown-subitem"><a href="/front/webpack/常见面试题/01.html" class="nav-link">
  常见面试题
</a></li></ul></li><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/设计模式/JS设计模式核心原理和应用实践/01.html" class="nav-link">
  JS设计模式核心原理和应用实践
</a></li></ul></li><li class="dropdown-item"><h4>
          算法和数据结构
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/算法和数据结构/入门级算法/01.html" class="nav-link">
  入门级算法
</a></li><li class="dropdown-subitem"><a href="/front/算法和数据结构/常见算法/01.html" class="nav-link">
  常见算法
</a></li><li class="dropdown-subitem"><a href="/front/算法和数据结构/常见数据结构/01.html" class="nav-link">
  常见数据结构
</a></li><li class="dropdown-subitem"><a href="/front/算法和数据结构/前端算法与数据结构/01.html" class="nav-link">
  前端算法与数据结构
</a></li></ul></li><li class="dropdown-item"><h4>
          基础必备
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/base/html必备/01.html" class="nav-link">
  HTML必备
</a></li><li class="dropdown-subitem"><a href="/front/base/CSS必备/01.html" class="nav-link">
  CSS必备
</a></li><li class="dropdown-subitem"><a href="/front/base/JS基础/01.html" class="nav-link">
  JS基础
</a></li><li class="dropdown-subitem"><a href="/front/base/JS进阶/01.html" class="nav-link">
  JS进阶
</a></li><li class="dropdown-subitem"><a href="/front/base/JS练习/01.html" class="nav-link">
  JS练习
</a></li><li class="dropdown-subitem"><a href="/front/base/网络基础/01.html" class="nav-link">
  网络基础
</a></li><li class="dropdown-subitem"><a href="/books/JS高级程序设计/01.html" class="nav-link">
  JS高级程序设计
</a></li><li class="dropdown-subitem"><a href="/front/base/浏览器相关基础/01.html" class="nav-link">
  浏览器相关基础
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="电子" class="dropdown-title"><span class="title">电子</span> <span class="arrow down"></span></button> <button type="button" aria-label="电子" class="mobile-dropdown-title"><span class="title">电子</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          STM32
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/电子/STM32四轴飞行器/01.html" class="nav-link">
  STM32四轴飞行器
</a></li></ul></li><li class="dropdown-item"><h4>
          Arduino
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/电子/Arduino墙画机/01.html" class="nav-link">
  Arduino墙画机
</a></li><li class="dropdown-subitem"><a href="/电子/Arduino四轴飞行器/01.html" class="nav-link">
  Arduino四轴飞行器
</a></li><li class="dropdown-subitem"><a href="/电子/Arduino四足仿生机器人/01.html" class="nav-link">
  Arduino四足仿生机器人
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/关于我/01.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/fangfeiyue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Vue
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/深入浅出Vue.js/01.html" class="nav-link">
  深入浅出Vue
</a></li><li class="dropdown-subitem"><a href="/front/vue/vue/01.html" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/front/vue/vue-router/01.html" class="nav-link">
  VueRouter
</a></li><li class="dropdown-subitem"><a href="/front/vue/Vuex/01.html" class="nav-link">
  Vuex
</a></li><li class="dropdown-subitem"><a href="/front/vue/vue3/01.html" class="nav-link">
  Vue3核心剖析
</a></li><li class="dropdown-subitem"><a href="/front/vue/Vue知识点简单梳理/01.html" class="nav-link">
  Vue知识点简单梳理
</a></li></ul></li><li class="dropdown-item"><h4>
          React
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/深入React技术栈/01.html" class="nav-link">
  深入React技术栈
</a></li><li class="dropdown-subitem"><a href="/front/react/React进阶实践指南/01.html" class="nav-link">
  React进阶实践指南
</a></li><li class="dropdown-subitem"><a href="/front/react/React知识点简单梳理/01.html" class="nav-link">
  React知识点简单梳理
</a></li></ul></li><li class="dropdown-item"><h4>
          混合开发
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/混合开发/01.html" class="nav-link">
  混合开发探究
</a></li></ul></li><li class="dropdown-item"><h4>
          TypeScript
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/ts/极简入门Typescript/01.html" class="nav-link">
  极简入门Typescript
</a></li></ul></li><li class="dropdown-item"><h4>
          Webpack
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/webpack/极简入门webpack/01.html" class="nav-link">
  极简入门
</a></li><li class="dropdown-subitem"><a href="/front/webpack/常见面试题/01.html" class="nav-link">
  常见面试题
</a></li></ul></li><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/设计模式/JS设计模式核心原理和应用实践/01.html" class="nav-link">
  JS设计模式核心原理和应用实践
</a></li></ul></li><li class="dropdown-item"><h4>
          算法和数据结构
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/算法和数据结构/入门级算法/01.html" class="nav-link">
  入门级算法
</a></li><li class="dropdown-subitem"><a href="/front/算法和数据结构/常见算法/01.html" class="nav-link">
  常见算法
</a></li><li class="dropdown-subitem"><a href="/front/算法和数据结构/常见数据结构/01.html" class="nav-link">
  常见数据结构
</a></li><li class="dropdown-subitem"><a href="/front/算法和数据结构/前端算法与数据结构/01.html" class="nav-link">
  前端算法与数据结构
</a></li></ul></li><li class="dropdown-item"><h4>
          基础必备
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/base/html必备/01.html" class="nav-link">
  HTML必备
</a></li><li class="dropdown-subitem"><a href="/front/base/CSS必备/01.html" class="nav-link">
  CSS必备
</a></li><li class="dropdown-subitem"><a href="/front/base/JS基础/01.html" class="nav-link">
  JS基础
</a></li><li class="dropdown-subitem"><a href="/front/base/JS进阶/01.html" class="nav-link">
  JS进阶
</a></li><li class="dropdown-subitem"><a href="/front/base/JS练习/01.html" class="nav-link">
  JS练习
</a></li><li class="dropdown-subitem"><a href="/front/base/网络基础/01.html" class="nav-link">
  网络基础
</a></li><li class="dropdown-subitem"><a href="/books/JS高级程序设计/01.html" class="nav-link">
  JS高级程序设计
</a></li><li class="dropdown-subitem"><a href="/front/base/浏览器相关基础/01.html" class="nav-link">
  浏览器相关基础
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="电子" class="dropdown-title"><span class="title">电子</span> <span class="arrow down"></span></button> <button type="button" aria-label="电子" class="mobile-dropdown-title"><span class="title">电子</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          STM32
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/电子/STM32四轴飞行器/01.html" class="nav-link">
  STM32四轴飞行器
</a></li></ul></li><li class="dropdown-item"><h4>
          Arduino
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/电子/Arduino墙画机/01.html" class="nav-link">
  Arduino墙画机
</a></li><li class="dropdown-subitem"><a href="/电子/Arduino四轴飞行器/01.html" class="nav-link">
  Arduino四轴飞行器
</a></li><li class="dropdown-subitem"><a href="/电子/Arduino四足仿生机器人/01.html" class="nav-link">
  Arduino四足仿生机器人
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/关于我/01.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/fangfeiyue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>深入浅出VUE.JS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/books/深入浅出Vue.js/01.html" class="sidebar-link">Vue.js简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/01.html#什么是vue-js" class="sidebar-link">什么是Vue.js</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/01.html#vue-js简史" class="sidebar-link">Vue.js简史</a></li></ul></li><li><a href="/books/深入浅出Vue.js/02.html" class="sidebar-link">Object的变化侦测</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/02.html#什么是变化侦测" class="sidebar-link">什么是变化侦测</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/02.html#如何追踪变化" class="sidebar-link">如何追踪变化</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/02.html#如何收集依赖" class="sidebar-link">如何收集依赖</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/02.html#依赖收集在哪里" class="sidebar-link">依赖收集在哪里</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/02.html#依赖是谁" class="sidebar-link">依赖是谁</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/02.html#什么是watcher" class="sidebar-link">什么是Watcher</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/02.html#递归侦测所有key" class="sidebar-link">递归侦测所有key</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/02.html#关于object的问题" class="sidebar-link">关于Object的问题</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/02.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/books/深入浅出Vue.js/03.html" class="sidebar-link">Array的变化侦测</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/03.html#如何追踪变化" class="sidebar-link">如何追踪变化</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/03.html#拦截器" class="sidebar-link">拦截器</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/03.html#使用拦截器覆盖array原型" class="sidebar-link">使用拦截器覆盖Array原型</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/03.html#将拦截器方法挂载到数组的属性上" class="sidebar-link">将拦截器方法挂载到数组的属性上</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/03.html#如何收集依赖" class="sidebar-link">如何收集依赖</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/03.html#依赖列表存在哪儿" class="sidebar-link">依赖列表存在哪儿</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/03.html#收集依赖" class="sidebar-link">收集依赖</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/03.html#在拦截器中获取observer实例" class="sidebar-link">在拦截器中获取Observer实例</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/03.html#向数组的依赖发送通知" class="sidebar-link">向数组的依赖发送通知</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/03.html#侦测数组中元素的变化" class="sidebar-link">侦测数组中元素的变化</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/03.html#侦测新增元素的变化" class="sidebar-link">侦测新增元素的变化</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/03.html#关于array的问题" class="sidebar-link">关于Array的问题</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/03.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/books/深入浅出Vue.js/04.html" class="sidebar-link">变化侦测相关的API实现原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/04.html#vm-watch" class="sidebar-link">vm.$watch</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/04.html#vm-set" class="sidebar-link">vm.$set</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/04.html#vm-delete" class="sidebar-link">vm.$delete</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/04.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/books/深入浅出Vue.js/05.html" class="sidebar-link">虚拟DOM简介</a></li><li><a href="/books/深入浅出Vue.js/06.html" class="sidebar-link">VNode</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/06.html#什么是vnode" class="sidebar-link">什么是VNode</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/06.html#vnode的作用" class="sidebar-link">VNode的作用</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/06.html#vnode的类型" class="sidebar-link">VNode的类型</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/06.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/books/深入浅出Vue.js/07.html" class="sidebar-link">patch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/07.html#patch介绍" class="sidebar-link">patch介绍</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/07.html#创建节点" class="sidebar-link">创建节点</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/07.html#删除节点-2" class="sidebar-link">删除节点</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/07.html#更新节点-2" class="sidebar-link">更新节点</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/07.html#更新子节点" class="sidebar-link">更新子节点</a></li></ul></li><li><a href="/books/深入浅出Vue.js/08.html" class="sidebar-link">模板编译</a></li><li><a href="/books/深入浅出Vue.js/09.html" class="sidebar-link">解析器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/09.html#解析器的作用" class="sidebar-link">解析器的作用</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/09.html#文本解析器" class="sidebar-link">文本解析器</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/09.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/books/深入浅出Vue.js/10.html" class="sidebar-link">优化器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/10.html#找出所有静态节点并标记" class="sidebar-link">找出所有静态节点并标记</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/10.html#找出所有静态根节点并标记" class="sidebar-link">找出所有静态根节点并标记</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/10.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/books/深入浅出Vue.js/11.html" class="sidebar-link">代码生成器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/11.html#通过ast生成代码字符串" class="sidebar-link">通过AST生成代码字符串</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/11.html#代码生成器的原理" class="sidebar-link">代码生成器的原理</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/11.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/books/深入浅出Vue.js/13.html" class="active sidebar-link">实例方法和全局API的实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/13.html#数据相关的实例方法" class="sidebar-link">数据相关的实例方法</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/13.html#事件相关的实例方法" class="sidebar-link">事件相关的实例方法</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/13.html#生命周期相关的实例方法" class="sidebar-link">生命周期相关的实例方法</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/13.html#全局api的实现原理" class="sidebar-link">全局API的实现原理</a></li></ul></li><li><a href="/books/深入浅出Vue.js/14.html" class="sidebar-link">生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/14.html#初始化inject" class="sidebar-link">初始化inject</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/14.html#初始化状态" class="sidebar-link">初始化状态</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/14.html#errorcaptured与错误处理" class="sidebar-link">errorCaptured与错误处理</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/14.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/books/深入浅出Vue.js/15.html" class="sidebar-link">指令的奥秘</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/15.html#自定义指令的内部原理" class="sidebar-link">自定义指令的内部原理</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/15.html#虚拟dom钩子函数" class="sidebar-link">虚拟DOM钩子函数</a></li></ul></li><li><a href="/books/深入浅出Vue.js/16.html" class="sidebar-link">过滤器的奥秘</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/16.html#过滤器的原理" class="sidebar-link">过滤器的原理</a></li></ul></li><li><a href="/books/深入浅出Vue.js/17.html" class="sidebar-link">最佳实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#为列表渲染设置属性key" class="sidebar-link">为列表渲染设置属性key</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#在v-if-v-if-else-v-else中使用key" class="sidebar-link">在v-if/v-if-else/v-else中使用key</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#路由切换组件不变" class="sidebar-link">路由切换组件不变</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#区分vuex与props的使用边界" class="sidebar-link">区分Vuex与props的使用边界</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#避免v-if和v-for一起使用" class="sidebar-link">避免v-if和v-for一起使用</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#为组件样式设置作用域" class="sidebar-link">为组件样式设置作用域</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#避免在scoped中使用元素选择器" class="sidebar-link">避免在scoped中使用元素选择器</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#单文件组件如何命名" class="sidebar-link">单文件组件如何命名</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#指令缩写" class="sidebar-link">指令缩写</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#简单的计算属性" class="sidebar-link">简单的计算属性</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#模板中简单的表达式" class="sidebar-link">模板中简单的表达式</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#多个特性的元素应该分多行撰写-每个特性一行。" class="sidebar-link">多个特性的元素应该分多行撰写，每个特性一行。</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#prop名的大小写" class="sidebar-link">prop名的大小写</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#自闭合组件" class="sidebar-link">自闭合组件</a></li><li class="sidebar-sub-header"><a href="/books/深入浅出Vue.js/17.html#js-jsx中的组件名大小写" class="sidebar-link">JS/JSX中的组件名大小写</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><ul><li></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> initMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./init'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> stateMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./state'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> renderMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./render'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> eventsMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./events'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> lifecycleMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./lifecycle'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> warn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span>

<span class="token keyword">function</span> <span class="token function">Vue</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Vue</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Vue is a constructor and should be called with the `new` keyword'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token function">stateMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token function">eventsMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token function">lifecycleMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token function">renderMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Vue
</code></pre></div><p>上述代码定义了Vue构造函数，分别调用了initMixin、stateMixin、eventsMixin、lifecycleMixin和renderMixin五个函数。这五个函数的作用是向Vue的原型挂载方法。</p> <p>以initMixin为例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initMixin</span> <span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 做些什么</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当函数initMixin被调用时，会向Vue构造函数的prototype属性添加 _init方法。执行new Vue()时，会调用 _init方法，该方法实现了一系列初始化操作，包括整个生命周期的流程以及响应式系统流程的启动等。</p> <h2 id="数据相关的实例方法"><a href="#数据相关的实例方法" class="header-anchor">#</a> 数据相关的实例方法</h2> <p>与数据相关的实例方法有：vm.$watch、vm.$set和vm.$delete</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  set<span class="token punctuation">,</span>
  del
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../observer/index'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">stateMixin</span> <span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$set <span class="token operator">=</span> set
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$<span class="token keyword">delete</span> <span class="token operator">=</span> del
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$watch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">expOrFn<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="事件相关的实例方法"><a href="#事件相关的实例方法" class="header-anchor">#</a> 事件相关的实例方法</h2> <p>与事件相关的实例方法有：vm.$on、vm.$once、vm.$off和vm.$emit</p> <h3 id="vm-on"><a href="#vm-on" class="header-anchor">#</a> vm.$on</h3> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre></div><p>参数：</p> <p>{string | Array<string>} event
{Function} callback</string></p> <p>用法:</p> <p>监听当前实例上的自定义事件，事件可以由vm.$emit触发。回调函数会接收所有传入事件所触发的函数的额外参数。</p> <p>示例:</p> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'hi'</span><span class="token punctuation">)</span>
<span class="token comment">// =&gt; &quot;hi&quot;</span>
</code></pre></div><p>原理:</p> <p>在注册事件时将回调函数收集起来，在触发事件时将收集起来的回调函数依次调用即可</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$on</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> event<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span>event<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token comment">//在执行new Vue()时，Vue会执行this._init方法进行一系列初始化操作，其中就会在Vue.js的实例上创建一个 _events属性，用来存储事件</span>
    <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> vm
<span class="token punctuation">}</span>
</code></pre></div><h3 id="vm-off"><a href="#vm-off" class="header-anchor">#</a> vm.$off</h3> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span><span class="token punctuation">[</span>event<span class="token punctuation">,</span> callback<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>参数：</p> <ul><li>{string | Array<string>} event</string></li> <li>{Function} callback</li></ul> <p>用法：移除自定义事件监听器。</p> <ul><li>如果没有提供参数，则移除所有的事件监听器。</li> <li>如果只提供了事件，则移除该事件所有的监听器。</li> <li>如果同时提供了事件与回调，则只移除这个回调的监听器。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$off</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token comment">// 处理没有提供参数的情况</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>_events <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> vm
  <span class="token punctuation">}</span>



  <span class="token comment">// 处理event为数组的情况</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> event<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span>event<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> vm
  <span class="token punctuation">}</span>



  <span class="token comment">// 处理只提供了事件名的情况</span>
  <span class="token keyword">const</span> cbs <span class="token operator">=</span> vm<span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span>
  <span class="token comment">// 如果这个事件没有被监听直接返回</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cbs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> vm
  <span class="token punctuation">}</span>
  <span class="token comment">// 移除该事件的所有监听器</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">return</span> vm
  <span class="token punctuation">}</span>



  <span class="token comment">//处理提供了event和回调的情况 只移除与fn相同的监听器</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cbs <span class="token operator">=</span> vm<span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span>
    <span class="token keyword">let</span> cb
    <span class="token keyword">let</span> i <span class="token operator">=</span> cbs<span class="token punctuation">.</span>length
    <span class="token comment">// 遍历列表是从后向前循环，这样在列表中移除当前位置的监听器时，不会影响列表中未遍历到的监听器的位置。如果是从前向后遍历，那么当从列表中移除一个监听器时，后面的监听器会自动向前移动一个位置，这会导致下一轮循环时跳过一个元素。</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cb <span class="token operator">=</span> cbs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cb <span class="token operator">===</span> fn <span class="token operator">||</span> cb<span class="token punctuation">.</span>fn <span class="token operator">===</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cbs<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> vm
<span class="token punctuation">}</span>
</code></pre></div><h3 id="vm-once"><a href="#vm-once" class="header-anchor">#</a> vm.$once</h3> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span><span class="token function">$once</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre></div><p>参数：</p> <ul><li>{string | Array<string>} event</string></li> <li>{Function} callback</li></ul> <p>用法：监听一个自定义事件，但是只触发一次，在第一次触发之后移除监听器。</p> <p>实现的思路：vm.$once中调用vm.$on来实现监听自定义事件的功能，当自定义事件触发后会执行拦截器，将监听器从事件列表中移除</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$once</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">function</span> <span class="token function">on</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> on<span class="token punctuation">)</span>
    <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  on<span class="token punctuation">.</span>fn <span class="token operator">=</span> fn
  vm<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> on<span class="token punctuation">)</span>
  <span class="token keyword">return</span> vm
<span class="token punctuation">}</span>
</code></pre></div><h3 id="vm-emit"><a href="#vm-emit" class="header-anchor">#</a> vm.$emit</h3> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span> event<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>args<span class="token punctuation">]</span> <span class="token punctuation">)</span>
</code></pre></div><p>参数：</p> <ul><li>{string} event</li> <li>[...args]</li></ul> <p>用法：触发当前实例上的事件。附加参数都会传给监听器回调。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$emit</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token comment">// 取出事件监听器回调函数列表</span>
  <span class="token keyword">let</span> cbs <span class="token operator">=</span> vm<span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cbs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// toArray的作用是将类似于数组的数据转换成真正的数组</span>
    <span class="token comment">// [].slice.call(arguments, 1)</span>
    <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">toArray</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> cbs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        cbs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">event handler for &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> vm
<span class="token punctuation">}</span>
</code></pre></div><h2 id="生命周期相关的实例方法"><a href="#生命周期相关的实例方法" class="header-anchor">#</a> 生命周期相关的实例方法</h2> <p>相关的方法有vm.$mount、vm.$forceUpdate、vm.$nextTick和vm.$destroy。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">lifecycleMixin</span> <span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$forceUpdate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 做点什么</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$destroy</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 做点什么</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">renderMixin</span> <span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$nextTick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 做点什么</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>vm.$mount方法则是在跨平台的代码中挂载到Vue构造函数的prototype属性上的</p> <h3 id="vm-forceupdate"><a href="#vm-forceupdate" class="header-anchor">#</a> vm.$forceUpdate</h3> <p>vm.$forceUpdate的原理：手动执行实例watcher的update方法，使Vue.js实例重新渲染</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$forceUpdate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>vm.$forceUpdate仅仅影响实例本身以及插入插槽内容的子组件，而不是所有子组件。</p> <h3 id="vm-destroy"><a href="#vm-destroy" class="header-anchor">#</a> vm.$destroy</h3> <p>vm.$destroy的作用是完全销毁一个实例，它会清理该实例与其他实例的连接，并解绑其全部指令及监听器，同时会触发beforeDestroy和destroyed的钩子函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$destroy</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token comment">// 防止vm.$destroy被反复执行</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_isBeingDestroyed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 销毁组件之前触发beforeDestroy钩子函数</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeDestroy'</span><span class="token punctuation">)</span>
  vm<span class="token punctuation">.</span>_isBeingDestroyed <span class="token operator">=</span> <span class="token boolean">true</span>


  <span class="token comment">// 清理当前组件与父组件之间的连接</span>
  <span class="token keyword">const</span> parent <span class="token operator">=</span> vm<span class="token punctuation">.</span>$parent
  <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>parent<span class="token punctuation">.</span>_isBeingDestroyed <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>abstract<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当前实例有父级，同时父级没有被销毁且不是抽象组件，就将自己从父级子列表中删除</span>
    <span class="token function">remove</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>$children<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


  <span class="token comment">// 从watcher监听的所有状态的依赖列表中移除watcher</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">.</span><span class="token function">teardown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Vue.js提供了vm.$watch方法，它允许用户监听某个状态。因此，还需要销毁用户使用vm.$watch所创建的watcher实例</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> vm<span class="token punctuation">.</span>_watchers<span class="token punctuation">.</span>length
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 每当创建watcher实例时，都将watcher实例添加到vm._watchers中，当用户使用vm.$watch时，会在vm._watchers中添加一个watcher实例，通过vm._watchers就可以得到所有watcher实例，只需要遍历vm._watchers并依次执行每一项watcher实例的teardown方法，就可以将watcher实例从它所监听的状态的依赖列表中移除</span>
    vm<span class="token punctuation">.</span>_watchers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">teardown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Vue.js实例添加 _isDestroyed属性来表示Vue.js实例已经被销毁</span>
  vm<span class="token punctuation">.</span>_isDestroyed <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token comment">// 在vnode树上触发destroy钩子函数解绑指令</span>
  vm<span class="token punctuation">.</span><span class="token function">__patch__</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_vnode<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token comment">// 触发destroyed钩子函数</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'destroyed'</span><span class="token punctuation">)</span>
  <span class="token comment">// 移除所有的事件监听器</span>
  vm<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">remove</span> <span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="vm-nexttick"><a href="#vm-nexttick" class="header-anchor">#</a> vm.$nextTick</h3> <p>在Vue.js中，当状态发生变化时，watcher会得到通知，然后触发虚拟DOM的渲染流程。而watcher触发渲染这个操作并不是同步的，而是异步的。Vue.js中有一个队列，每当需要渲染时，会将watcher推送到这个队列中，在下一次事件循环中再让watcher触发渲染的流程。</p> <p>当更新了状态（数据）后，需要对新DOM做一些操作，但是这时我们其实获取不到更新后的DOM，因为还没有重新渲染。这个时候我们需要使用nextTick方法</p> <ol><li>为什么vue.js使用异步更新策略</li></ol> <p>Vue.js 2.0开始使用虚拟DOM进行渲染，变化侦测的通知只发送到组件，组件内用到的所有状态的变化都会通知到同一个watcher，然后虚拟DOM会对整个组件进行“比对（diff）”并更改DOM。也就是说，如果在同一轮事件循环中有两个数据发生了变化，那么组件的watcher会收到两份通知，从而进行两次渲染。事实上，并不需要渲染两次，虚拟DOM会对整个组件进行渲染，所以只需要等所有状态都修改完毕后，一次性将整个组件的DOM渲染到最新即可。</p> <p>要解决这个问题，Vue.js的实现方式是将收到通知的watcher实例添加到队列中缓存起来，并且在添加到队列之前检查其中是否已经存在相同的watcher，只有不存在时，才将watcher实例添加到队列中。然后在下一次事件循环（event loop）中，Vue.js会让队列中的watcher触发渲染流程并清空队列。这样就可以保证即便在同一事件循环中有两个状态发生改变，watcher最后也只执行一次渲染流程。</p> <ol start="2"><li>什么是事件循环</li></ol> <p>JS是一门单线程脚本语言，JS在执行过程中只有一个主线程处理任务，当执行到异步任务时会将这个任务放到事件队列中，被放到事件队列中的任务不会立即执行回到，而是等当前执行栈中所有同步任务执行完毕后，去检查微任务队列中是否有事件存在，如果存在就依次执行微任务队列中事件对应的回调，执行完后去宏任队列中取出一个任务加入到当前执行栈中，当执行栈的任务执行完后，再去微任务队列检查是否有事件，如此循环这个循环就叫事件循环。</p> <p>异步任务分两种类型：</p> <ul><li>宏任务
<ul><li>setTimeout</li> <li>setInterval</li> <li>setImmediate</li> <li>MessageChannel</li> <li>requestAnimationFrame</li> <li>I/O</li> <li>UI交互事件</li> <li>...</li></ul></li> <li>微任务
<ul><li>Promise.then</li> <li>MutationObserver</li> <li>Object.observe</li> <li>process.nextTick</li> <li>...</li></ul></li></ul> <ol start="3"><li>什么是执行栈</li></ol> <p>当我们执行一个方法时，JavaScript会生成一个与这个方法对应的执行环境（context），又叫执行上下文。这个执行环境中有这个方法的私有作用域、上层作用域的指向、方法的参数、私有作用域中定义的变量以及this对象。这个执行环境会被添加到一个栈中，这个栈就是执行栈。</p> <p>如果在这个方法的代码中执行到了一行函数调用语句，那么JavaScript会生成这个函数的执行环境并将其添加到执行栈中，然后进入这个执行环境继续执行其中的代码。执行完毕并返回结果后，JavaScript会退出执行环境并把这个执行环境从栈中销毁，回到上一个方法的执行环境。这个过程反复进行，直到执行栈中的代码全部执行完毕。这个执行环境的栈就是执行栈。</p> <p>注意：修改数据一定要放在nextTick的前面，否则会得不到最新的DOM</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ……</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ……</span>
    <span class="token function-variable function">example</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果是先使用vm.$nextTick注册回调，然后修改数据，则在微任务队列中先执行使用vm.$nextTick注册的回调，然后执行更新DOM的回调。所以在回调中得不到最新的DOM，因为此时DOM还没有更新</span>
      <span class="token comment">// 先使用nextTick注册回调</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// DOM没有更新</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// 然后修改数据</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">'changed'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Vue原型上的 $nextTick方法只是调用了nextTick方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> nextTick <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span>

<span class="token comment">// Vue原型上的 $nextTick方法调用了nextTick方法</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$nextTick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">nextTick</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>nextTick方法的实现</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 用来存储vm.$nextTick参数中提供的回调。</span>
<span class="token keyword">const</span> callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment">// 来标记是否已经向任务队列中添加了一个任务</span>
<span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">function</span> <span class="token function">flushCallbacks</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  pending <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">const</span> copies <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  callbacks<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> copies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    copies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> microTimerFunc
<span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 使用Promise.then将flushCallbacks添加到微任务队列中。</span>
<span class="token function-variable function">microTimerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span> <span class="token punctuation">(</span><span class="token parameter">cb<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pending <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token function">microTimerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试一下</span>
<span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// f</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'f'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="vm-mount"><a href="#vm-mount" class="header-anchor">#</a> vm.$mount</h3> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span> <span class="token punctuation">[</span>elementOrSelector<span class="token punctuation">]</span> <span class="token punctuation">)</span>
</code></pre></div><p>参数：{Element | string} [elementOrSelector]</p> <p>返回值：vm，即实例自身</p> <p>用法： 如果Vue.js实例在实例化时没有收到el选项，则它处于“未挂载”状态，没有关联的DOM元素。我们可以使用vm.$mount手动挂载一个未挂载的实例。如果没有提供elementOrSelector参数，模板将被渲染为文档之外的元素，并且必须使用原生DOM的API把它插入文档中。这个方法返回实例自身，因而可以链式调用其他实例方法。</p> <p>例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MyComponent <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;Hello!&lt;/div&gt;'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 创建并挂载到#app（会替换#app）</span>
<span class="token keyword">new</span> <span class="token class-name">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建并挂载到#app（会替换#app）</span>
<span class="token keyword">new</span> <span class="token class-name">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> el<span class="token operator">:</span> <span class="token string">'#app'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 或者，在文档之外渲染并且随后挂载</span>
<span class="token keyword">var</span> component <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>$el<span class="token punctuation">)</span>
</code></pre></div><p>在完整的构建版本中vm.$mount会检查模板是否已经转换成渲染函数。如果没有则进入编译过程，将模板编译成渲染函数，再进入挂载与渲染的流程。</p> <p>运行时版本的vm.$mount默认实例上已存在渲染函数，如果不存在就设置一个。这个渲染函数在执行时会返回一个空节点的VNode，保证正常执行。</p> <ol><li>完整版vm.$mount的实现原理</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 函数劫持，可以在原始功能上扩展一些其他功能</span>
<span class="token keyword">const</span> mount <span class="token operator">=</span> <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$mount
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$mount</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取el</span>
  el <span class="token operator">=</span> el <span class="token operator">&amp;&amp;</span> <span class="token function">query</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>

  <span class="token comment">// 可以获取到一些用户设置的参数</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options

  <span class="token comment">// 是否存在渲染函数，不存在则将模板编译成渲染函数</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> template <span class="token operator">=</span> options<span class="token punctuation">.</span>template
    <span class="token comment">// </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> template <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果template是字符串且以#开头，则看作为选择器</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'#'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 获取DOM元素后将它的innerHTML作为模板</span>
          template <span class="token operator">=</span> <span class="token function">idToTemplate</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">.</span>nodeType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果是DOM元素则使用DOM元素的innerHTML作为模板</span>
        template <span class="token operator">=</span> template<span class="token punctuation">.</span>innerHTML
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果template不是字符串也不是DOM元素，会触发警告</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'invalid template option:'</span> <span class="token operator">+</span> template<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果用户没有提供template配置项，则从用户提供的el选项中获取模板</span>
      template <span class="token operator">=</span> <span class="token function">getOuterHTML</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 编译相关逻辑</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 通过执行compileToFunctions函数将模板编译成渲染函数</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> render <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">compileToFunctions</span><span class="token punctuation">(</span>
        template<span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span>
      <span class="token punctuation">)</span>
      <span class="token comment">// 将渲染函数设置到this.$options上</span>
      options<span class="token punctuation">.</span>render <span class="token operator">=</span> render
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">mount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> el<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">query</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> el <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果el是字符串(有可能是选择器)则通过querySelector获取元素</span>
    <span class="token keyword">const</span> selected <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
    
    <span class="token comment">// 如果获取不到则创建一个空div标签</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>selected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> selected
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果el不是字符串则认为是元素类型</span>
    <span class="token keyword">return</span> el
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 返回DOM元素的HTML字符串</span>
<span class="token keyword">function</span> <span class="token function">getOuterHTML</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>outerHTML<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> el<span class="token punctuation">.</span>outerHTML
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
    container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> container<span class="token punctuation">.</span>innerHTML
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获取DOM元素后将它的innerHTML作为模板</span>
<span class="token keyword">function</span> <span class="token function">idToTemplate</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
  <span class="token keyword">return</span> el <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">.</span>innerHTML
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">compileToFunctions</span> <span class="token punctuation">(</span><span class="token parameter">template<span class="token punctuation">,</span> options<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 让options成为可选参数</span>
  options <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>

  <span class="token comment">// 检查缓存中是否已经存在编译后的模板</span>
  <span class="token keyword">const</span> key <span class="token operator">=</span> options<span class="token punctuation">.</span>delimiters
    <span class="token operator">?</span> <span class="token function">String</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>delimiters<span class="token punctuation">)</span> <span class="token operator">+</span> template
    <span class="token operator">:</span> template

  <span class="token comment">// 如果模板已经被编译，就会直接返回缓存中的结果</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 编译</span>
  <span class="token keyword">const</span> compiled <span class="token operator">=</span> <span class="token function">compile</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> options<span class="token punctuation">)</span>

  <span class="token comment">// 将代码字符串转换为函数</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  res<span class="token punctuation">.</span>render <span class="token operator">=</span> <span class="token function">createFunction</span><span class="token punctuation">(</span>compiled<span class="token punctuation">.</span>render<span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createFunction</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>只包含运行时版本的vm.$mount的实现原理</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$mount</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  el <span class="token operator">=</span> el <span class="token operator">&amp;&amp;</span> inBrowser <span class="token operator">?</span> <span class="token function">query</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">undefined</span>
  <span class="token comment">// 将ID转换为DOM元素后，使用mountComponent函数将Vue.js实例挂载到DOM元素上</span>
  <span class="token keyword">return</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> el<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mountComponent</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 是否存在渲染函数</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 不存在，则设置一个默认的渲染函数createEmptyVNode，该渲染函数执行后，会返回一个注释类型的VNode节点，并在开发环境中给出警告</span>
    vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>render <span class="token operator">=</span> createEmptyVNode
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 在开发环境发出警告</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 触发生命周期钩子</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeMount'</span><span class="token punctuation">)</span>

  <span class="token comment">// 执行挂载操作，挂载是持续性的，挂载之后，每当状态发生变化时，都会进行渲染操作</span>
  vm<span class="token punctuation">.</span>_watcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// _update调用虚拟DOM中的patch方法来执行节点的比对与渲染操作</span>
    <span class="token comment">// _render的作用是执行渲染函数，得到一份最新的VNode节点树</span>
    <span class="token comment">// 这行代码的作用是先调用渲染函数得到一份最新的VNode节点树，然后通过 _update方法对最新的VNode和上一次渲染用到的旧VNode进行对比并更新DOM节点</span>
    vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> noop<span class="token punctuation">)</span>

  <span class="token comment">// 触发mounted钩子函数</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'mounted'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> vm
<span class="token punctuation">}</span>
</code></pre></div><p>watcher观察数据的过程：</p> <p>状态通过Observer转换成响应式之后，每当触发getter时，会从全局的某个属性中获取watcher实例并将它添加到数据的依赖列表中。watcher在读取数据之前，会先将自己设置到全局的某个属性中。而数据被读取会触发getter，所以会将watcher收集到依赖列表中。收集好依赖后，当数据发生变化时，会向依赖列表中的watcher发送通知。</p> <p>由于Watcher的第二个参数支持函数，所以当watcher执行函数时，函数中所读取的数据都将会触发getter去全局找到watcher并将其收集到函数的依赖列表中。也就是说，函数中读取的所有数据都将被watcher观察。这些数据中的任何一个发生变化时，watcher都将得到通知。</p> <h2 id="全局api的实现原理"><a href="#全局api的实现原理" class="header-anchor">#</a> 全局API的实现原理</h2> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span> options <span class="token punctuation">)</span>
</code></pre></div><p>参数：{Object} options</p> <p>用法：使用基础Vue构造器创建一个“子类”，其参数是一个包含“组件选项”的对象。</p> <p>例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;mount-point&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token comment">// 创建构造器</span>
<span class="token keyword">var</span> Profile <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token string">'&lt;p&gt;{{firstName}} {{lastName}} aka {{alias}}&lt;/p&gt;'</span><span class="token punctuation">,</span>
  <span class="token comment">// data在Vue.extend()必须是函数</span>
  <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      firstName<span class="token operator">:</span> <span class="token string">'Walter'</span><span class="token punctuation">,</span>
      lastName<span class="token operator">:</span> <span class="token string">'White'</span><span class="token punctuation">,</span>
      alias<span class="token operator">:</span> <span class="token string">'Heisenberg'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 创建Profile实例，并挂载到一个元素上</span>
<span class="token keyword">new</span> <span class="token class-name">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#mount-point'</span><span class="token punctuation">)</span>
</code></pre></div><p>代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> cid <span class="token operator">=</span> <span class="token number">1</span>

Vue<span class="token punctuation">.</span><span class="token function-variable function">extend</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">extendOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  extendOptions <span class="token operator">=</span> extendOptions <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">const</span> Super <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">const</span> SuperId <span class="token operator">=</span> Super<span class="token punctuation">.</span>cid
  <span class="token keyword">const</span> cachedCtors <span class="token operator">=</span> extendOptions<span class="token punctuation">.</span>_Ctor <span class="token operator">||</span> <span class="token punctuation">(</span>extendOptions<span class="token punctuation">.</span>_Ctor <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 缓存，如果已经存在，直接返回缓存中的结果</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedCtors<span class="token punctuation">[</span>SuperId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> cachedCtors<span class="token punctuation">[</span>SuperId<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> name <span class="token operator">=</span> extendOptions<span class="token punctuation">.</span>name <span class="token operator">||</span> Super<span class="token punctuation">.</span>options<span class="token punctuation">.</span>name

  <span class="token comment">// 如果发现name选项不合规发出警告</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[a-zA-Z][\w-]*$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token string">'Invalid component name: &quot;'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'&quot;. Component names '</span> <span class="token operator">+</span>
        <span class="token string">'can only contain alphanumeric characters and the hyphen, '</span> <span class="token operator">+</span>
        <span class="token string">'and must start with a letter.'</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>


  <span class="token keyword">const</span> <span class="token function-variable function">Sub</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">VueComponent</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 父类的原型继承到子类中，继承Vue的能力</span>
  <span class="token class-name">Sub</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Super</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
  <span class="token class-name">Sub</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Sub

  <span class="token comment">// 为子类添加cid，它表示每个类的唯一标识</span>
  Sub<span class="token punctuation">.</span>cid <span class="token operator">=</span> cid<span class="token operator">++</span>

  <span class="token comment">// 合并了父类选项与子类选项</span>
  <span class="token comment">// mergeOptions方法会将两个选项合并为一个新对象</span>
  Sub<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>
    Super<span class="token punctuation">.</span>options<span class="token punctuation">,</span>
    extendOptions
  <span class="token punctuation">)</span>
  <span class="token comment">// 将父类保存到子类的super属性中</span>
  Sub<span class="token punctuation">[</span><span class="token string">'super'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Super

  <span class="token comment">// 如果选项中存在props属性，则初始化它，初始化props的作用是将key代理到 _props中。例如，vm.name实际上可以访问到的是Sub.prototype._props.name</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initProps</span><span class="token punctuation">(</span>Sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 初始化computed</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initComputed</span><span class="token punctuation">(</span>Sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 将父类中存在的属性依次复制到子类中</span>
  Sub<span class="token punctuation">.</span>extend <span class="token operator">=</span> Super<span class="token punctuation">.</span>extend
  Sub<span class="token punctuation">.</span>mixin <span class="token operator">=</span> Super<span class="token punctuation">.</span>mixin
  Sub<span class="token punctuation">.</span>use <span class="token operator">=</span> Super<span class="token punctuation">.</span>use

  <span class="token comment">// ASSET_TYPES = ['component', 'directive', 'filter']</span>
  <span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Sub<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> Super<span class="token punctuation">[</span>type<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>components<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> Sub
  <span class="token punctuation">}</span>

  Sub<span class="token punctuation">.</span>superOptions <span class="token operator">=</span> Super<span class="token punctuation">.</span>options
  Sub<span class="token punctuation">.</span>extendOptions <span class="token operator">=</span> extendOptions
  Sub<span class="token punctuation">.</span>sealedOptions <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Sub<span class="token punctuation">.</span>options<span class="token punctuation">)</span>

  <span class="token comment">// 使用父类的id作为缓存的key，将子类缓存在cachedCtors中</span>
  cachedCtors<span class="token punctuation">[</span>SuperId<span class="token punctuation">]</span> <span class="token operator">=</span> Sub
  <span class="token keyword">return</span> Sub
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initProps</span> <span class="token punctuation">(</span><span class="token parameter">Comp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> Comp<span class="token punctuation">.</span>options<span class="token punctuation">.</span>props
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token class-name">Comp</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_props</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">proxy</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> sourceKey<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxyGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxySetter</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
  <span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> sharedPropertyDefinition<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将computed对象遍历一遍，并将里面的每一项都定义一遍</span>
<span class="token keyword">function</span> <span class="token function">initComputed</span> <span class="token punctuation">(</span><span class="token parameter">Comp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> computed <span class="token operator">=</span> Comp<span class="token punctuation">.</span>options<span class="token punctuation">.</span>computed
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// computed对象中的每一项进行定义</span>
    <span class="token function">defineComputed</span><span class="token punctuation">(</span><span class="token class-name">Comp</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> key<span class="token punctuation">,</span> computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> context<span class="token punctuation">]</span> <span class="token punctuation">)</span>
</code></pre></div><p>参数：</p> <ul><li>{Function} [callback]</li> <li>{Object} [context]</li></ul> <p>用法：在下次DOM更新循环结束之后执行延迟回调，修改数据之后立即使用这个方法获取更新后的DOM</p> <p>示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 修改数据</span>
vm<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">'Hello'</span>
<span class="token comment">// DOM还没有更新</span>
Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// DOM更新了</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 作为一个Promise使用（这是Vue.js 2.1.0版本新增的）</span>
Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// DOM更新了</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>实现原理和前面的vm.$nextTick一样</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> nextTick <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span>

Vue<span class="token punctuation">.</span>nextTick <span class="token operator">=</span> nextTick
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span> target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value <span class="token punctuation">)</span>
</code></pre></div><p>参数：</p> <ul><li>{Object | Array} target</li> <li>{string | number} key</li> <li>{any} value</li></ul> <p>返回值：设置的值</p> <p>用法：设置对象的属性。如果对象是响应式的，确保属性被创建后也是响应式的，同时触发视图更新。这个方法主要用于避开Vue不能检测属性被添加的限制。</p> <p>Vue.set与前面介绍的vm.$set的实现原理相同</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> set <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../observer/index'</span>
Vue<span class="token punctuation">.</span>set <span class="token operator">=</span> set
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span> target<span class="token punctuation">,</span> key <span class="token punctuation">)</span>
</code></pre></div><p>参数：</p> <ul><li>{Object | Array} target</li> <li>{string | number} key/index</li></ul> <p>用法：删除对象的属性。如果对象是响应式的，确保删除能触发更新视图。这个方法主要用于避开Vue.js不能检测到属性被删除的限制。</p> <p>Vue.delete与vm.$delete的实现原理相同</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> del <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../observer/index'</span>
Vue<span class="token punctuation">.</span>delete <span class="token operator">=</span> del
</code></pre></div><h3 id="vue-directive"><a href="#vue-directive" class="header-anchor">#</a> Vue.directive</h3> <p>除了内置指令外，Vue还允许注册自定义指令</p> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span> id<span class="token punctuation">,</span> <span class="token punctuation">[</span>definition<span class="token punctuation">]</span> <span class="token punctuation">)</span>
</code></pre></div><p>参数：</p> <ul><li>{string} id</li> <li>{Function | Object} [definition]</li></ul> <p>用法：注册或获取全局指令。</p> <p>示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 注册</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'my-directive'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">bind</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">inserted</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">componentUpdated</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">unbind</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 注册（指令函数）</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'my-directive'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里将会被bind和update调用</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// getter方法，返回已注册的指令</span>
<span class="token keyword">var</span> myDirective <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'my-directive'</span><span class="token punctuation">)</span>
</code></pre></div><p>代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 用于保存指令的位置</span>
Vue<span class="token punctuation">.</span>options <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token string">'directives'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

Vue<span class="token punctuation">.</span><span class="token function-variable function">directive</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> definition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果definition参数不存在，则使用id从this.options ['directives'] 中读出指令并将它返回</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>definition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token string">'directives'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果definition参数存在，则说明是注册操作，那么进而判断definition参数的类型是否是函数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> definition <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果是函数监听bind和update两个事件</span>
      definition <span class="token operator">=</span> <span class="token punctuation">{</span> bind<span class="token operator">:</span> definition<span class="token punctuation">,</span> update<span class="token operator">:</span> definition <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 如果definition不是函数，则说明它是用户自定义的指令对象，此时不需要做任何操作，直接将用户提供的指令对象保存在this.options['directives'] 上</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token string">'directives'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> definition
    <span class="token keyword">return</span> definition
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="vue-filter"><a href="#vue-filter" class="header-anchor">#</a> Vue.filter</h3> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span> id<span class="token punctuation">,</span> <span class="token punctuation">[</span>definition<span class="token punctuation">]</span> <span class="token punctuation">)</span>
</code></pre></div><p>参数：</p> <ul><li>{string} id</li> <li>{Function | Object} [definition]</li></ul> <p>用法：注册或获取全局过滤器。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 注册</span>
Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'my-filter'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 返回处理后的值</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// getter方法，返回已注册的过滤器</span>
<span class="token keyword">var</span> myFilter <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'my-filter'</span><span class="token punctuation">)</span>
</code></pre></div><p>过滤器可以用在两个地方：双花括号插值和v-bind表达式，由“管道”符号指示。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 在双花括号中 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> message <span class="token operator">|</span> capitalize <span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 在v<span class="token operator">-</span>bind中 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div v<span class="token operator">-</span>bind<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">&quot;rawId | formatId&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><p>代码</p> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token string">'filters'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

Vue<span class="token punctuation">.</span><span class="token function-variable function">filter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> definition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>definition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token string">'filters'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token string">'filters'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> definition
    <span class="token keyword">return</span> definition
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="vue-component"><a href="#vue-component" class="header-anchor">#</a> Vue.component</h3> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span> id<span class="token punctuation">,</span> <span class="token punctuation">[</span>definition<span class="token punctuation">]</span> <span class="token punctuation">)</span>
</code></pre></div><p>参数：</p> <ul><li>{string} id</li> <li>{Function | Object} [definition]
用法：注册或获取全局组件。注册组件时，还会自动使用给定的id设置组件的名称。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 注册组件，传入一个扩展过的构造器</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">,</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 注册组件，传入一个选项对象（自动调用Vue.extend）</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 获取注册的组件（始终返回构造器）</span>
<span class="token keyword">var</span> MyComponent <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">)</span>
</code></pre></div><p>代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 新增components属性用于存放组件</span>
Vue<span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token string">'components'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token comment">// </span>
Vue<span class="token punctuation">.</span><span class="token function-variable function">component</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> definition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>definition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果definition不存在，则使用id从this.options['components'] 中读出组件并将它返回</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token string">'components'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// definition参数支持两种参数，分别是选项对象和构造器。组件其实是一个构造函数，是使用Vue.extend生成的子类，需要将参数definition统一处理成构造器</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果选项对象中没有设置组件名，则自动使用给定的id设置组件的名称</span>
      definition<span class="token punctuation">.</span>name <span class="token operator">=</span> definition<span class="token punctuation">.</span>name <span class="token operator">||</span> id
      <span class="token comment">// 调用Vue.extend方法将它变成Vue的子类</span>
      definition <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token string">'components'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> definition
    <span class="token keyword">return</span> definition
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Vue源码中Vue.directive、Vue.filter和Vue.component是放在一起实现的</p> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span>options <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token comment">// ASSET_TYPES = ['component', 'directive', 'filter']</span>
<span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> definition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>definition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'component'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        definition<span class="token punctuation">.</span>name <span class="token operator">=</span> definition<span class="token punctuation">.</span>name <span class="token operator">||</span> id
        definition <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>definition<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'directive'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> definition <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        definition <span class="token operator">=</span> <span class="token punctuation">{</span> bind<span class="token operator">:</span> definition<span class="token punctuation">,</span> update<span class="token operator">:</span> definition <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> definition
      <span class="token keyword">return</span> definition
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="vue-use"><a href="#vue-use" class="header-anchor">#</a> Vue.use</h3> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span> plugin <span class="token punctuation">)</span>
</code></pre></div><p>参数：{Object | Function} plugin</p> <p>用法：安装Vue.js插件。如果插件是一个对象，必须提供install方法。如果插件是一个函数，它会被作为install方法。调用install方法时，会将Vue作为参数传入。install方法被同一个插件多次调用时，插件也只会被安装一次。</p> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function-variable function">use</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">plugin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> installedPlugins <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_installedPlugins <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_installedPlugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// 判断插件是不是已经被注册过</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>installedPlugins<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 其他参数</span>
  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">toArray</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

  <span class="token comment">// 将Vue添加到args列表的最前面，保证install方法被执行时第一个参数是Vue，其余参数是注册插件时传入的参数。</span>
  args<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin<span class="token punctuation">.</span>install <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    plugin<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>plugin<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 插件添加到installedPlugins中，保证相同的插件不会反复被注册</span>
  installedPlugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="vue-mixin"><a href="#vue-mixin" class="header-anchor">#</a> Vue.mixin</h3> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span> mixin <span class="token punctuation">)</span>
</code></pre></div><p>参数：{Object} mixin</p> <p>用法：全局注册一个混入（mixin），影响注册之后创建的每个Vue.js实例。插件作者可以使用混入向组件注入自定义行为（例如：监听生命周期钩子）。不推荐在应用代码中使用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 为自定义的选项myOption注入一个处理器</span>
Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> myOption <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>myOption
    <span class="token keyword">if</span> <span class="token punctuation">(</span>myOption<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myOption<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  myOption<span class="token operator">:</span> <span class="token string">'hello!'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// =&gt; &quot;hello!&quot;</span>
</code></pre></div><p>实现原理</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mergeOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initMixin</span> <span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function-variable function">mixin</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">mixin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// mergeOptions方法会将用户传入的mixin与this.options合并成一个新对象，然后将这个生成的新对象覆盖this.options属性，这里的this.options其实就是Vue.options</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">,</span> mixin<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>mixin方法修改了Vue.options属性，之后创建的每个实例都会用到该属性，会影响创建的每个实例。但也正是因为有影响，所以mixin在某些场景下才堪称神器。</p> <h3 id="vue-compile"><a href="#vue-compile" class="header-anchor">#</a> Vue.compile</h3> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span> template <span class="token punctuation">)</span>
</code></pre></div><p>参数：{string} template</p> <p>用法：编译模板字符串并返回包含渲染函数的对象，只在完整版中才有效，因为只有完整版包含编译器</p> <p>示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> res <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">'&lt;div&gt;&lt;span&gt;{{ msg }}&lt;/span&gt;&lt;/div&gt;'</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    msg<span class="token operator">:</span> <span class="token string">'hello'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  render<span class="token operator">:</span> res<span class="token punctuation">.</span>render
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Vue.compile方法只需要调用编译器就可以实现功能</span>
Vue<span class="token punctuation">.</span>compile <span class="token operator">=</span> compileToFunctions
</code></pre></div><h3 id="vue-version"><a href="#vue-version" class="header-anchor">#</a> Vue.version</h3> <p>作用：提供字符串形式的Vue.js安装版本号。这对社区的插件和组件来说非常有用，你可以根据不同的版本号采取不同的策略。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> version <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>version<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>version <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Vue.js v2.x.x</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>version <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Vue.js v1.x.x</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// 不支持的Vue.js版本</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Vue.js在构建文件的配置中定义了 <strong>VERSION</strong> 常量，使用rollup-plugin-replace插件在构建的过程中将代码中的常量 <strong>VERSION</strong> 替换成package.json文件中的版本号</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/books/深入浅出Vue.js/11.html" class="prev">
        代码生成器
      </a></span> <span class="next"><a href="/books/深入浅出Vue.js/14.html">
        生命周期
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.590f3e5d.js" defer></script><script src="/assets/js/2.f73decc9.js" defer></script><script src="/assets/js/160.8cdb57f8.js" defer></script><script src="/assets/js/63.b9a657c2.js" defer></script>
  </body>
</html>
